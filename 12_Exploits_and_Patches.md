## Exploits and Patches
I software normalmente contengono molti bug, che sono opportunità per gli attaccanti. Questi bug possono essere sfruttati per ottenere l'accesso non autorizzato a un sistema, per eseguire codice arbitrario o per causare un crash del sistema. 

### Program execution
**Compilatore:** il compilatore è un software che traduce il codice sorgente in codice macchina, così che il computer possa eseguirlo. 

**Computer memory:**
- *Code memory:* contiene il codice eseguibile. La CPU tiene conto dell'Istruction Pointer (IP) per sapere quale istruzione eseguire.
- *Data memory:* contiene i dati utilizzati dal programma(variabili, costanti, ecc.). La CPU tiene conto del Data Pointer (DP) per sapere dove trovare i dati.
    - *Stack memory:* contiene le variabili locali e i parametri delle funzioni. I dati del programma vengono inseriti in un frame di stack. Il frame di stack viene rimosso quando la funzione termina. La CPU tiene conto dello Stack Pointer (SP) per sapere dove trovare i dati. Contiene:
        - *Return address:* l'indirizzo di ritorno della funzione. Che in caso di ricorsione può essere sovrascritto più volte.
        - *Local variables:* le variabili locali della funzione.
        - *Parameters:* i parametri della funzione.
- *OS memory:* pronto per fare system call.

### Buffer overflow
La memoria è finita e non può essere sovrascritta. Se una ricorsione è troppo profonda, il programma va in crash. 

Normalmente un bug può causare problemi con la memoria dello stack(segmentation o page fault). Le vulnerabilità delle meoria sono:
- i linguaggi low-level non sono memory safe.
- le informazioni su come eseguire il programma sono scritte inline con i dati nello stack.

**Threat model:** 
- *Attacker's goal:* eseguire codice arbitrario o avere privilegi elevati.
- *System's goal:* integrità.
- *Attacker's capabilities:* può scrivere input arbitrari.

Un programma chiede all'utente di inserire un input, ma non controlla la lunghezza dell'input. L'attaccante può inserire un input più lungo del buffer, sovrascrivendo la memoria dello stack. L'attaccante può sovrascrivere il return address con un indirizzo arbitrario, così che il programma esegua il codice dell'attaccante(Stack Smashing Attack).

Questo codice si chiama *shellcode* e può essere usato per eseguire un shell remoto.
Lo shellcode deve:
- non contenere caratteri nulli, altrimeti la stringa si interrompe.
- essere scritto in modo da evitare problemi con la codifica(se il programma decodifica i caratteri o se il programma è case sensitive).

E' difficile fare un buffer overflow, perché bisogna conoscere la posizione della memoria dello stack e il return address. Quindi si può creare quindi un *NOP sled*, che è una sequenza di istruzioni NOP, che non fanno nulla finché non si arriva al codice dell'attaccante, così che l'attaccante non deve conoscere la posizione della memoria dello stack perchè tanto il codice è molto lungo.

### Mitigating buffer overflows
- *Stack canaries:* inserire un valore casuale prima del return address. Se il valore è cambiato, il programma termina.
- *Non-executable stack:* il sistema operativo può rendere non eseguibile la memoria dello stack.
- *Address space layout randomization (ASLR):* il sistema operativo può caricare il programma in una posizione casuale della memoria.

### Takeaways
Gli exploit sono dei bug che possono essere sfruttati dagli attaccanti. 

- mai fidarsi dell'input dell'utente.
- mai mischiare codice e dati(tipo le pagine web, dove puoi inserire codice malizioso).
- usare i migliori strumenti di sicurezza(memory safe languages, framework con protezione integrata, ecc.).
- consapevolezza e vigilanza(non puoi proteggerti da ciò che non conosci).
- patchare i bug il prima possibile.

Le 0-day vulnerabilities sono vulnerabilità sconosciute, che possono essere sfruttate dagli attaccanti. 
Ma gli attacchi più comuni sono quelli che sfruttano le vulnerabilità note, per cui è importante patchare i bug il prima possibile.

La gente non patcha i bug, quindi è meglio usare sistemi che automaticamente aggiornano i software.

Ticking clock: i white hat hacker hanno un tempo limitato per trovare i bug, prima che gli attaccanti li sfruttino.

Gli sviluppatori sono responsabili della sicurezza degli utenti, quindi è importante definire un processo di sicurezza e distribuire le patch il prima possibile.






